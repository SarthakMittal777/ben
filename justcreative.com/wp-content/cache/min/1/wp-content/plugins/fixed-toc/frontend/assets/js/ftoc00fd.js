'use strict';var fixedtoc=(function($){var option=(function(){var init=function(){fixedtocOption.scrollDuration=500;fixedtocOption.fadeTriggerDuration=5000;fixedtocOption.scrollOffset=parseToInt(fixedtocOption.scrollOffset);fixedtocOption.fixedOffsetX=parseToInt(fixedtocOption.fixedOffsetX);fixedtocOption.fixedOffsetY=parseToInt(fixedtocOption.fixedOffsetY);fixedtocOption.contentsFixedHeight=parseToInt(fixedtocOption.contentsFixedHeight);fixedtocOption.contentsWidthInPost=parseToInt(fixedtocOption.contentsWidthInPost);fixedtocOption.contentsHeightInPost=parseToInt(fixedtocOption.contentsHeightInPost);fixedtocOption.triggerBorderWidth=getBorderWidth(fixedtocOption.triggerBorder);fixedtocOption.contentsBorderWidth=getBorderWidth(fixedtocOption.contentsBorder);fixedtocOption.triggerSize=parseToInt(fixedtocOption.triggerSize)};var set=function(name,val,type){if('int'==type){fixedtocOption[name]=parseToInt(val)}else if('float'==type){fixedtocOption[name]=parseToFloat(val)}else{fixedtocOption[name]=val}};var update=function(name,val,type){set(name,val,type)};var remove=function(name){if(undefined!==fixedtocOption[name]){delete fixedtocOption[name]}};var getBorderWidth=function(border){switch(border){case 'thin':return 1;case 'medium':return 2;case 'bold':return 5;default:return 0}};return{init:init,set:set,update:update,remove:remove}})();var conditionObj={inWidgetProp:undefined,showAdminbar:function(){return fixedtocOption.showAdminbar},isQuickMin:function(){return fixedtocOption.isQuickMin},isEscMin:function(){return fixedtocOption.isEscMin},isEnterMax:function(){return fixedtocOption.isEnterMax},isNestedList:function(){return fixedtocOption.isNestedList},isColExpList:function(){return fixedtocOption.isColExpList},showColExpIcon:function(){return fixedtocOption.showColExpIcon},isAccordionList:function(){return fixedtocOption.isAccordionList},showTargetHint:function(){return!0},supportInPost:function(){return fixedtocOption.inPost},inWidget:function(){if(!fixedtocOption.inWidget){return!1}
if(undefined===this.inWidgetProp){this.inWidgetProp=!!$('#ftwp-widget-container').length}
return this.inWidgetProp},fixedWidget:function(){if(!this.inWidget()){return!1}
return fixedtocOption.fixedWidget},isAutoHeightFixedToPost:function(){return(0==fixedtocOption.contentsFixedHeight)},isFloat:function(){return'none'!=fixedtocOption.contentsFloatInPost},isAutoHeightInPost:function(){return(0==fixedtocOption.contentsHeightInPost)},isPositionAtFixed:function(position){return-1!=fixedtocOption.fixedPosition.indexOf(position)},isDebug:function(){return 1==fixedtocOption.debug},isNotBlur:function(){var ua=navigator.userAgent.toLowerCase();return(ua.indexOf('android')>-1)||(ua.indexOf('firefox')>-1)},isMobile:function(){return dataObj.data.window.width<=parseToInt(fixedtocOption.mobileMaxWidth)},isClickableHeader:function(){return 1==fixedtocOption.isClickableHeader},isColExpInitMobile:function(){return 1==fixedtocOption.contentsColexpInitMobile}};function parseToInt(str){return parseInt(str)||0}
function parseToFloat(str){return parseFloat(str)||0}
function getFixedHeight(eles){if(!eles.length){return 0}
var fixedHeight=0;eles.each(function(){var thisEle=$(this);if('fixed'==thisEle.css('position')){fixedHeight+=parseToInt(thisEle.outerHeight())}});return fixedHeight}
function preventDefaultEvt(evt){evt.preventDefault()}
function __return(){}
function getContentsHeight(contentsOuterHeight){return parseToInt(contentsOuterHeight-2*fixedtocOption.contentsBorderWidth)}
function consoleLog(str){if(conditionObj.isDebug()){console.log(str)}}
var $e;function createElements(){$e={window:$(window),document:$(document),body:$('body'),container:$('#ftwp-container'),trigger:$('#ftwp-trigger'),contents:$('#ftwp-contents'),header:$('#ftwp-header'),minIcon:$('#ftwp-header-minimize'),list:$('#ftwp-list'),postContent:$(fixedtocOption.postContentSelector),headings:$('.ftwp-heading')};$e.anchors=$e.list.find('.ftwp-anchor').not('.ftwp-otherpage-anchor');if(conditionObj.isNestedList()){$e.hasSubItems=$e.list.find('.ftwp-has-sub')}
if(conditionObj.showColExpIcon()){$e.colExpIcons=$e.list.find('.ftwp-icon-expand, .ftwp-icon-collapse')}
if(conditionObj.inWidget()){$e.widget=$('.ftwp-widget');$e.widgetContainer=$('#ftwp-widget-container')}
if(conditionObj.supportInPost()){$e.containerOuter=$('#ftwp-container-outer')}
consoleLog($e)}
function setAnchorIndex(){$e.anchors.each(function(i){$(this).data('index',i)})}
var dataObj=(function(){var data={};var setScrollTop=function(){data.scrollTop=$e.window.scrollTop()};var setWindowSize=function(){data.window={};data.window.width=window.innerWidth;data.window.height=window.innerHeight};var setDocumentHeight=function(){data.document={};data.document.height=Math.round($e.document.height())};var setAdminbarHeight=function(){data.adminbarHeight=conditionObj.showAdminbar()?getFixedHeight($('#wpadminbar')):0};var setFixedMenuHeight=function(){data.fixedMenuHeight=getFixedHeight($(fixedtocOption.fixedMenu))};var setFixedHeight=function(){if(fixedtocOption.fixedMenu){data.fixedHeight=data.adminbarHeight+data.fixedMenuHeight}else{data.fixedHeight=data.adminbarHeight}};var setFixedOffsetTop=function(){data.fixedOffsetTop=data.fixedHeight+fixedtocOption.fixedOffsetY};var setHeadingOffset=function(){data.headingOffset=data.fixedHeight+fixedtocOption.scrollOffset};var setHeadingsTop=function(){data.headingsTop=[];$.each($e.anchors,function(){var $heading=$($(this).attr('href'));var headingTop=$heading.length?parseToInt($heading.offset().top-data.headingOffset):NaN;if(!isNaN(headingTop)){data.headingsTop.push({headingTop:headingTop,anchorEle:$(this)})}})};var setPostRect=function(){data.postRect={};var postContentOffset=$e.postContent.offset();var postContentWidth=$e.postContent.outerWidth();var postContentHeight=$e.postContent.outerHeight();data.postRect.left=postContentOffset.left;data.postRect.top=postContentOffset.top;data.postRect.width=postContentWidth;data.postRect.right=data.postRect.left+data.postRect.width;data.postRect.bottom=postContentHeight+data.postRect.top;data.postRect.height=data.postRect.bottom-data.postRect.top};var setFtocRangeY=function(){data.ftocRangeY={};if(conditionObj.supportInPost()){data.ftocRangeY.top=data.inPostRangeY.bottom}else{data.ftocRangeY.top=data.postRect.top-data.fixedHeight}
switch(fixedtocOption.disappearPoint){case 'document-bottom':data.ftocRangeY.bottom=Math.round($e.document.height());break;default:data.ftocRangeY.bottom=data.postRect.bottom-data.window.height}};var containerOuterHeight=(function(){var set=function(){var height;if(conditionObj.isAutoHeightInPost()||fixedtocOption.contentsColexpInit){$e.container.css('position','static');height=$e.containerOuter.outerHeight();$e.container.css('position','')}else{height=fixedtocOption.contentsHeightInPost}
$e.containerOuter.css('height',height+'px');data.containerOuterHeight=height};var update=function(){if(!actionObj.location.inPost){return}
if(conditionObj.isAutoHeightInPost()){auto()}else{if('collapse'==$e.contents.data('colexp')){auto()}else{$e.containerOuter.css('height',fixedtocOption.contentsHeightInPost+'px');$e.contents.css('height',fixedtocOption.contentsHeightInPost+'px');listHeight.set(getContentsHeight(fixedtocOption.contentsHeightInPost));data.containerOuterHeight=$e.containerOuter.outerHeight()}}
function auto(){$e.containerOuter.css('height','auto');$e.contents.css('height','auto');listHeight.setAuto();data.containerOuterHeight=$e.containerOuter.outerHeight()}};return{set:set,update:update}})();var setInPostRangeY=function(){data.inPostRangeY={};data.inPostRangeY.top=0;data.inPostRangeY.bottom=$e.containerOuter.offset().top+data.containerOuterHeight-data.fixedHeight};var setInWidgetMinWidth=function(){data.inWidgetMinWidth=data.postRect.width+$e.widgetContainer.outerWidth()};var setFixedWidgetRangeY=function(){data.fixedWidgetRangeY={};data.fixedWidgetRangeY.top=$e.widgetContainer.offset().top-data.fixedHeight;data.fixedWidgetRangeY.bottom=data.ftocRangeY.bottom};var ftocRectInWidget=(function(){var set=function(){data.ftocRectInWidget={left:$e.widgetContainer.offset().left,top:data.fixedHeight,width:$e.widgetContainer.outerWidth(),height:getHeight()}};var getHeight=function(){var height;if('collapse'==$e.contents.data('colexp')){$e.contents.css('height','auto');height=$e.contents.outerHeight();$e.contents.css('height','')}else{height=window.innerHeight-data.fixedHeight}
return height};var updateOnResize=function(){set()};var updateHeight=function(){data.ftocRectInWidget.height=getHeight()};return{set:set,updateOnResize:updateOnResize,updateHeight:updateHeight}})();var updateOnResize=function(){setWindowSize();setScrollTop();setAdminbarHeight();if(fixedtocOption.fixedMenu){setFixedMenuHeight()}
setFixedHeight();setFixedOffsetTop();if(conditionObj.supportInPost()){containerOuterHeight.update();setInPostRangeY()}
setHeadingOffset();setPostRect();setFtocRangeY();if(conditionObj.inWidget()){setInWidgetMinWidth()}
if(conditionObj.fixedWidget()){setFixedWidgetRangeY();ftocRectInWidget.updateOnResize()}
setHeadingsTop();consoleLog(data)};var prevFixedMenuHeight;var updateOnScroll=function(){setScrollTop();if(!fixedtocOption.fixedMenu){return}
if(undefined===prevFixedMenuHeight){prevFixedMenuHeight=data.fixedMenuHeight}
setFixedMenuHeight();if(prevFixedMenuHeight!==data.fixedMenuHeight){setFixedHeight();setFixedOffsetTop();if(conditionObj.supportInPost()){setInPostRangeY()}
setHeadingOffset();setPostRect();setFtocRangeY();if(conditionObj.inWidget()){setInWidgetMinWidth()}
if(conditionObj.fixedWidget()){setFixedWidgetRangeY();ftocRectInWidget.updateOnResize()}
setHeadingsTop();prevFixedMenuHeight=data.fixedMenuHeight;consoleLog(data)}};var preDocumentHeight;var updateOnDocumentHeightChange=function(){setDocumentHeight();var curDocumentHeight=data.document.height;if(curDocumentHeight!=preDocumentHeight){fixedtoc.reload();preDocumentHeight=data.document.height}};return{data:data,ftocRectInWidget:ftocRectInWidget,createOnInit:function(){setWindowSize();setScrollTop();setAdminbarHeight();if(fixedtocOption.fixedMenu){setFixedMenuHeight()}
setFixedHeight();setFixedOffsetTop();if(conditionObj.supportInPost()){containerOuterHeight.set();setInPostRangeY()}
setHeadingOffset();setPostRect();setFtocRangeY();if(conditionObj.inWidget()){setInWidgetMinWidth()}
if(conditionObj.fixedWidget()){setFixedWidgetRangeY();ftocRectInWidget.set()}
setHeadingsTop();consoleLog(this.data)},updateOnResize:updateOnResize,updateOnScroll:updateOnScroll,updateInPost:function(){containerOuterHeight.update();setInPostRangeY();setHeadingOffset();setHeadingsTop();setPostRect();setFtocRangeY()},updateOnDocumentHeightChange:updateOnDocumentHeightChange,setDocumentHeight:setDocumentHeight}})();var locationObj=(function(){var inWidget=function(){return conditionObj.inWidget()&&!conditionObj.isMobile()};var fixedWidget=function(){if(!conditionObj.fixedWidget()){return!1}
if(!inWidget()){return!1}
return dataObj.data.fixedWidgetRangeY.top<=dataObj.data.scrollTop&&dataObj.data.fixedWidgetRangeY.bottom>dataObj.data.scrollTop};var inPost=function(){if(!conditionObj.supportInPost()){return!1}
return dataObj.data.inPostRangeY.bottom>dataObj.data.scrollTop};var fixedToPost=function(){return dataObj.data.ftocRangeY.top<=dataObj.data.scrollTop&&dataObj.data.ftocRangeY.bottom>dataObj.data.scrollTop};return{fixedWidget:fixedWidget,inWidget:inWidget,inPost:inPost,fixedToPost:fixedToPost}})();var actionObj=(function(){var location={fixedWidget:!1,inWidget:!1,inPost:!1,fixedToPost:!1,hidden:!1};var events=['common','hidden','fixedToPost','inPost','inWidget','fixedWidget'];var register=function(event,handler){if(-1==$.inArray(event,events)){consoleLog('Not support this event: '+event);return}
if(undefined!==handler._construct){$e.container.on('ftoc_'+event,handler._construct)}
if('common'!=event&&undefined!==handler._destruct){$e.container.on('_ftoc_'+event,handler._destruct)}};var activeByLocation=function(eventType){if(locationObj.fixedWidget()){if(!location.fixedWidget){setLocation('fixedWidget');activeThe('fixedWidget');consoleLog(location)}}else if(locationObj.inWidget()){if(!location.inWidget){setLocation('inWidget');activeThe('inWidget');consoleLog(location)}}else if(locationObj.inPost()){if(!location.inPost){setLocation('inPost');activeThe('inPost');consoleLog(location)}}else if(locationObj.fixedToPost()){if(!location.fixedToPost){setLocation('fixedToPost');activeThe('fixedToPost');consoleLog(location)}}else{if(!location.hidden){setLocation('hidden');activeThe('hidden');consoleLog(location)}}
function activeThe(event){var len=events.length;var eventParam={location:event,eventType:eventType};for(var j=1;j<len;j++){if(event==events[j]){continue}
$e.container.trigger('_ftoc_'+events[j],eventParam)}
$e.container.trigger('ftoc_'+event,eventParam)}
function setLocation(event){for(var i=1,len=events.length;i<len;i++){if(undefined!==event&&event==events[i]){location[event]=!0}else{location[events[i]]=!1}}}};return{location:location,register:register,updateOnResize:function(){activeByLocation('resize')},updateOnScroll:function(){activeByLocation('scroll')},init:function(){$e.container.trigger('ftoc_common');activeByLocation('init')}}})();var listHeight=(function(){var set=function(h){var contentsHeight;if(undefined!==h){contentsHeight=h}else{contentsHeight=$e.contents.height()}
$e.list.css('height',(contentsHeight-$e.header.outerHeight())+'px')};var setAuto=function(){$e.list.css('height','auto')};var unset=function(){$e.list.css('height','')};return{set:set,setAuto:setAuto,unset:unset}})();if(conditionObj.isColExpList()){var colExpSubList=(function(){var _construct=function(){if(conditionObj.showColExpIcon()&&conditionObj.isAccordionList()){$e.colExpIcons.on('click',accordionHandler);$e.container.on('ftocAfterScrollToTarget',accordionHandler)}else if(conditionObj.showColExpIcon()){$e.colExpIcons.on('click',toggleHandler);$e.container.on('ftocAfterScrollToTarget',toggleHandler)}else{$e.container.on('ftocAfterScrollToTarget',accordionHandler)}
if(conditionObj.showColExpIcon()){$e.colExpIcons.on('mousedown',preventDefaultEvt)}
$e.container.on('ftocAfterTargetIndicated',function(evt,$anchor){expandSubListOnIndicator($anchor)});consoleLog('Activated colExpSubList().')};var toggleHandler=function(evt,$anchor){var $currentTarget=undefined===$anchor?$(this):$anchor;var $hasSubItem=$currentTarget.parent('.ftwp-has-sub');if(!$hasSubItem.length){return}
if($currentTarget.hasClass('ftwp-anchor')){expand($hasSubItem,$currentTarget.prev('button'))}else{toggle($hasSubItem,$currentTarget)}};var accordionHandler=function(evt,$anchor){var $currentTarget=undefined===$anchor?$(this):$anchor;var $item=$currentTarget.parent('.ftwp-item');if(!$item.length){return}
if($currentTarget.hasClass('ftwp-anchor')){accordion($item,$currentTarget.prev('button'))}else{toggle($item,$currentTarget);collapseOther($item)}};var toggle=function($hasSubItem,$icon){if($hasSubItem.hasClass('ftwp-collapse')){expand($hasSubItem,$icon)}else if($hasSubItem.hasClass('ftwp-expand')){collapse($hasSubItem,$icon)}};var accordion=function($item,$icon){collapseOther($item);if($item.hasClass('ftwp-has-sub')){expand($item,$icon)}};var collapse=function($hasSubItem,$icon){$hasSubItem.removeClass('ftwp-expand').addClass('ftwp-collapse');if($icon.length){$icon.removeClass('ftwp-icon-expand').addClass('ftwp-icon-collapse')}};var expand=function($hasSubItem,$icon){$hasSubItem.removeClass('ftwp-collapse').addClass('ftwp-expand');if($icon.length){$icon.removeClass('ftwp-icon-collapse').addClass('ftwp-icon-expand')}};var collapseOther=function($item){$e.hasSubItems.each(function(){var $thisItem=$(this);if($thisItem.get(0)==$item.get(0)){return}
if($thisItem.find($item).length){return}
collapse($thisItem,$thisItem.children('button'))})};var getIconEle=function($this){var $icon;if($this.hasClass('ftwp-anchor')){$icon=$this.prev('button')}else if('button'==$this.prop('tagName').toLowerCase()){$icon=$this}
return $icon};var expandSubListOnIndicator=function($anchor){if(conditionObj.isAccordionList()){collapseOther($anchor.parent('.ftwp-item'))}
var $hasSubItems=$anchor.parents('.ftwp-has-sub');if($hasSubItems){$hasSubItems.each(function(){var $hasSubItem=$(this);var $icon=$hasSubItem.children('button');expand($hasSubItem,$icon)})}};return{_construct:_construct}})()}
var scrollToTarget=(function(){var _construct=function(){$e.anchors.on('click',function(evt){evt.preventDefault();var $anchor=$(evt.currentTarget);animateScroll($anchor)});$e.anchors.on('mousedown',preventDefaultEvt);consoleLog('Activated scrollToTarget().')};var animateScrolling=!1;var animateScroll=function($anchor){var hash=$anchor.attr('href');var $targetObj=$(hash);var index=$anchor.data('index');var headingsTop=dataObj.data.headingsTop[index];if(undefined===headingsTop){return}
var top=headingsTop.headingTop;var headingID=hash.substr(1);$e.headings.removeClass('ftwp-heading-target');$targetObj.attr('id','').addClass('ftwp-heading-target');window.location.hash=hash;$targetObj.attr('id',headingID);$('html, body').animate({scrollTop:top},{duration:fixedtocOption.scrollDuration,start:function(){animateScrolling=!0}}).promise().then(function(){animateScrolling=!1;var curHeadingTop=dataObj.data.headingsTop[index].headingTop;if(top!=curHeadingTop){$('html, body').animate({scrollTop:curHeadingTop},100,function(){var curHeadingTop2=dataObj.data.headingsTop[index].headingTop;if(curHeadingTop!=curHeadingTop2){$('html, body').animate({scrollTop:curHeadingTop2},1,function(){})}})}
activeCurrent($anchor);$e.container.trigger('ftocAfterScrollToTarget',[$anchor,top])})};var activedEle;var activeCurrent=function($anchor){deactivatePrev();activedEle=$anchor;$anchor.addClass('ftwp-active');if(actionObj.location.fixedToPost||actionObj.location.fixedWidget){if(!$anchor.is(':focus')&&!animateScrolling){$anchor.trigger('focus')}}
if(conditionObj.showColExpIcon()){var $icon=$anchor.prev();if($icon.length){$icon.addClass('ftwp-active')}}};var deactivatePrev=function(){if(activedEle){activedEle.removeClass('ftwp-active').trigger('blur');if(conditionObj.showColExpIcon()){var $icon=activedEle.prev();if($icon.length){$icon.removeClass('ftwp-active')}}}};var deactivateAll=function(){activedEle=undefined;$e.anchors.removeClass('ftwp-active').trigger('blur');if(conditionObj.showColExpIcon()){$e.colExpIcons.removeClass('ftwp-active')}};return{_construct:_construct,activeCurrent:activeCurrent,deactivateAll:deactivateAll,deactivatePrev:deactivatePrev}})();var targetIndicator=(function(){var _construct=function(){$e.window.on('ftocScroll',hint).on('ftocResize',hint);consoleLog('Actived targetIndicator().')};var start=function(){$e.window.on('ftocScroll',hint).on('ftocResize',hint)};var stop=function(){$e.window.off('ftocScroll',hint).off('ftocResize',hint)};var prevHeading;var preDocumentHeight;var hint=function(){var headingsTop=dataObj.data.headingsTop;var scrollTop=dataObj.data.scrollTop;if(headingsTop[0].headingTop>scrollTop||dataObj.data.ftocRangeY.bottom<scrollTop){if(undefined!==prevHeading){scrollToTarget.deactivateAll()}
prevHeading=undefined;return}
if(undefined!==preDocumentHeight&&preDocumentHeight!=dataObj.data.document.height){activeCurrentAnchor();consoleLog('Fixed target indicator!!');return}
if(undefined!==prevHeading&&prevHeading[0].headingTop<=scrollTop&&prevHeading[1].headingTop>scrollTop){return}
activeCurrentAnchor();function activeCurrentAnchor(){$.each(headingsTop,function(i){if(undefined===headingsTop[i+1]&&this.headingTop<=dataObj.data.ftocRangeY.bottom){prevHeading=[this,headingsTop[i],i];preDocumentHeight=dataObj.data.document.height;scrollToTarget.activeCurrent(this.anchorEle);$e.container.trigger('ftocAfterTargetIndicated',[this.anchorEle,scrollTop]);return!1}
if(this.headingTop<=scrollTop&&headingsTop[i+1].headingTop>scrollTop){prevHeading=[this,headingsTop[i+1],i];if(undefined===dataObj.data.document){dataObj.setDocumentHeight()}
preDocumentHeight=dataObj.data.document.height;scrollToTarget.activeCurrent(this.anchorEle);$e.container.trigger('ftocAfterTargetIndicated',[this.anchorEle,scrollTop]);return!1}})}};return{_construct:_construct,start:start,stop:stop}})();var noScrollWindow=(function(){var _construct=function(evt,eventParam){init();if('fixedToPost'==eventParam.location){$e.container.on('ftocAfterMaximize',on);$e.container.on('ftocAfterMinimize',off)}
consoleLog('Actived noScrollWindow().')};var _destruct=function(){off();$e.container.off('ftocAfterMaximize',on);$e.container.off('ftocAfterMinimize',off);consoleLog('Deactivated noScrollWindow().')};var init=function(){on()};var on=function(){$e.list.on('scroll',start);$e.list.on('mouseleave',stop);$e.document.on('click',clickDocumentHandler);$e.window.on('scroll',stop)};var off=function(){$e.body.removeClass('ftwp-no-scroll');$e.list.off('scroll',start);$e.list.off('mouseleave',stop);$e.document.off('click',clickDocumentHandler);$e.window.off('scroll',stop)};var start=function(){$e.body.addClass('ftwp-no-scroll')};var stop=function(){if($e.body.hasClass('ftwp-no-scroll')){$e.list.off('scroll',start);$e.body.removeClass('ftwp-no-scroll');setTimeout(function(){$e.list.on('scroll',start)},100)}};var clickDocumentHandler=function(evt){if(!($.contains($e.list.get(0),evt.target))){stop()}};return{_construct:_construct,_destruct:_destruct,on:on,off:off}})();var hideToc=(function(){var _construct=function(){$e.container.addClass('ftwp-hidden-state');consoleLog('Actived hideToc().')};var _destruct=function(){$e.container.removeClass('ftwp-hidden-state');consoleLog('Deactivated hideToc().')};return{_construct:_construct,_destruct:_destruct}})();var ftocInOut=(function(){var _construct=function(){init();location.set();$e.window.on('ftocResize',location.set);effect.in();$e.container.on('ftocAfterMinMax',effect.inOut);consoleLog('Actived ftocInOut().')};var _destruct=function(){uninit();location.unset();$e.window.off('ftocResize',location.set);contentsHeight.unset();listHeight.unset();effect.out();$e.container.off('ftocAfterMinMax',effect.inOut);consoleLog('Deactivated ftocInOut().')};var init=function(){$e.container.addClass('ftwp-fixed-to-post');if(!$e.container.parent().is($e.body)){$e.container.appendTo($e.body)}
$e.minIcon.addClass('ftwp-icon-minimize');if(conditionObj.isMobile()){if($e.container.hasClass('ftwp-maximize')){$e.container.removeClass('ftwp-maximize').addClass('ftwp-minimize')}}};var uninit=function(){$e.container.removeClass('ftwp-fixed-to-post');$e.minIcon.removeClass('ftwp-icon-minimize')};var location=(function(){var setPosition=function(){effect.setTransformOrigin();if(conditionObj.isPositionAtFixed('left')){var right=dataObj.data.window.width-dataObj.data.postRect.left+fixedtocOption.fixedOffsetX;var leftSpace=dataObj.data.postRect.left-fixedtocOption.fixedOffsetX;setLeftStyle($e.trigger,right,leftSpace);setLeftStyle($e.contents,right,leftSpace)}else{var left=dataObj.data.postRect.right+fixedtocOption.fixedOffsetX;var rightSpace=dataObj.data.window.width-left;setRightStyle($e.trigger,left,rightSpace);setRightStyle($e.contents,left,rightSpace)}
resetTopStyle();contentsHeight.reset()};var isEdge=function(ele,space){var eleWidth=ele.outerWidth();return space<=eleWidth};var setLeftStyle=function(ele,right,space){if(isEdge(ele,space)){ele.css({left:'0px',right:'auto'});effect.reverseTransformOrigin(ele)}else{ele.css({right:right+'px',left:'auto'})}};var setRightStyle=function(ele,left,space){if(isEdge(ele,space)){ele.css({right:'0px',left:'auto'});effect.reverseTransformOrigin(ele)}else{ele.css({left:left+'px',right:'auto'})}};var resetTopStyle=function(){if(conditionObj.isPositionAtFixed('top')){$e.trigger.css('top',dataObj.data.fixedOffsetTop+'px');$e.contents.css('top',dataObj.data.fixedOffsetTop+'px')}else if(conditionObj.isPositionAtFixed('middle')){$e.contents.css('top',dataObj.data.fixedHeight+'px')}else{$e.trigger.css('top','');$e.contents.css('top','')}};var unsetPosition=function(){$e.trigger.css({left:'',right:'',top:''});$e.contents.css({left:'',right:'',top:''});effect.removeTransformOrigin()};return{set:setPosition,unset:unsetPosition}})();var contentsHeight=(function(){var reset=function(){var originalHeight=getOriginal();var newHeight;if(conditionObj.isPositionAtFixed('middle')){newHeight=dataObj.data.window.height-dataObj.data.fixedHeight}else{newHeight=dataObj.data.window.height-dataObj.data.fixedOffsetTop}
var height;if(newHeight<originalHeight){height=newHeight}else{height=originalHeight}
$e.contents.css('height',height+'px');var contentsHeight=getContentsHeight(height);listHeight.set(contentsHeight)};var unset=function(){$e.contents.css('height','')};var isTopReset=function(originalHeight){var top=dataObj.data.fixedOffsetTop;if(!top){return!1}
return(top+originalHeight)>dataObj.data.window.height};var isBottomReset=function(originalHeight){if(!conditionObj.isPositionAtFixed('bottom')){return!1}
var offsetBottom=fixedtocOption.fixedOffsetY;if(0==offsetBottom){return!1}
return(offsetBottom+originalHeight)>dataObj.data.window.height};var getOriginal=function(){var contentsHeight;if(conditionObj.isAutoHeightFixedToPost()){if(conditionObj.isColExpList()){contentsHeight=window.innerHeight}else{listHeight.setAuto();$e.contents.css('height','auto');contentsHeight=$e.contents.outerHeight();unset();listHeight.unset()}}else{contentsHeight=fixedtocOption.contentsFixedHeight}
return contentsHeight};return{reset:reset,unset:unset}})();var effect=(function(){var inCls='ftwp-animate-'+fixedtocOption.inOutEffect+'-in';var inOutCls='ftwp-animate-'+fixedtocOption.inOutEffect+'-inOut';var showIn=function(){$e.container.addClass(inCls)};var showInOut=function(){$e.container.removeClass(inCls+' '+inOutCls);void $e.container.offsetWidth;$e.container.addClass(inOutCls);setTimeout(function(){$e.container.removeClass(inOutCls)},1000)};var hideOut=function(){$e.container.removeClass(inCls+' '+inOutCls)};var transformCls,newTransformCls;var setTransformOrigin=function(){var re=fixedtocOption.fixedPosition.match(/(\w+)-(\w+)/i);if(re){var horizontal=re[2];var vertical=re[1];if('left'==horizontal){horizontal='right'}else if('right'==horizontal){horizontal='left'}
if('middle'==vertical){vertical='center'}
transformCls='ftwp-transform-'+horizontal+'-'+vertical;$e.trigger.removeClass(newTransformCls).addClass(transformCls);$e.contents.removeClass(newTransformCls).addClass(transformCls)}};var reverseTransformOrigin=function(ele){if(transformCls.match(/left/i)){newTransformCls=transformCls.replace('left','right')}else{newTransformCls=transformCls.replace('right','left')}
ele.removeClass(transformCls).addClass(newTransformCls)};var removeTransformOrigin=function(){$e.trigger.removeClass(transformCls+' '+newTransformCls);$e.contents.removeClass(transformCls+' '+newTransformCls)};return{inCls:inCls,in:showIn,inOut:showInOut,out:hideOut,setTransformOrigin:setTransformOrigin,reverseTransformOrigin:reverseTransformOrigin,removeTransformOrigin:removeTransformOrigin}})();return{_construct:_construct,_destruct:_destruct,effectInCls:effect.inCls}})();var minMaxFtoc=(function(){var _construct=function(){var clickableElement=conditionObj.isClickableHeader()?$e.header:$e.minIcon;$e.trigger.on('click',maximize);clickableElement.on('click',minimize);$e.trigger.on('mousedown',preventDefaultEvt);clickableElement.on('mousedown',preventDefaultEvt);if(conditionObj.isQuickMin()){$e.document.on('click touchstart',quickMin)}
if(conditionObj.isEscMin()){$e.document.on('keyup',escMin)}
if(conditionObj.isEnterMax()){$e.document.on('keyup',enterMax)}
consoleLog('Actived minMaxFtoc().')};var _destruct=function(){var clickableElement=conditionObj.isClickableHeader()?$e.header:$e.minIcon;$e.trigger.off('click',maximize);clickableElement.off('click',minimize);$e.trigger.off('mousedown',preventDefaultEvt);clickableElement.off('mousedown',preventDefaultEvt);if(conditionObj.isQuickMin()){$e.document.off('click',quickMin)}
if(conditionObj.isEscMin()){$e.document.off('keyup',escMin)}
if(conditionObj.isEnterMax()){$e.document.off('keyup',enterMax)}
consoleLog('Deactivated minMaxFtoc.')};var maximize=function(){$e.container.removeClass('ftwp-minimize').addClass('ftwp-maximize');$e.container.trigger('ftocAfterMinMax');$e.container.trigger('ftocAfterMaximize');consoleLog('Maximized FTOC.')};var minimize=function(){$e.container.removeClass('ftwp-maximize').addClass('ftwp-minimize');$e.container.trigger('ftocAfterMinMax');$e.container.trigger('ftocAfterMinimize');consoleLog('Minimized FTOC.')};var quickMin=function(evt){if((evt.type=='touchstart')&&(dataObj.data.window.width>768)){return}
if($e.container.hasClass('ftwp-maximize')&&!($.contains($e.container.get(0),evt.target))){minimize()}};var escMin=function(evt){if($e.container.hasClass('ftwp-maximize')&&27==evt.keyCode){minimize()}};var enterMax=function(evt){if($e.container.hasClass('ftwp-minimize')&&13==evt.keyCode){maximize()}};var isMax=function(){return!!$e.container.hasClass('ftwp-maximize')};var isMin=function(){return!!$e.container.hasClass('ftwp-minimize')};return{_construct:_construct,_destruct:_destruct,isMax:isMax,isMin:isMin,minimize:minimize}})();var fadeTrigger=(function(){var fadeTimeoutId;var fadeCls='ftwp-fade-trigger';var unfadeCls='ftwp-unfade-trigger';var _construct=function(){if($e.container.hasClass('ftwp-minimize')){start()}
$e.trigger.on('mouseenter',pause).on('mouseleave',restart);$e.container.on('ftocAfterMinimize',start).on('ftocAfterMaximize',stop);consoleLog('Actived fadeTrigger().')};var _destruct=function(){stop();$e.trigger.off('mouseenter',mouseEnter);$e.trigger.off('mouseleave',mouseLeave);$e.container.off('ftocAfterMinimize',start);$e.container.off('ftocAfterMaximize',stop);consoleLog('Deactivated fadeTrigger().')};var start=function(){if(undefined===fadeTimeoutId){setTimeout(function(){$e.container.removeClass(ftocInOut.effectInCls)},500);fadeTimeoutId=setTimeout(function(){$e.trigger.addClass(fadeCls)},fixedtocOption.fadeTriggerDuration)}};var stop=function(){if(undefined!==fadeTimeoutId){clearTimeout(fadeTimeoutId);fadeTimeoutId=undefined;$e.trigger.removeClass(fadeCls+' '+unfadeCls)}};var pause=function(){if(undefined!==fadeTimeoutId){clearTimeout(fadeTimeoutId);$e.trigger.removeClass(fadeCls).addClass(unfadeCls)}};var restart=function(){if(undefined!==fadeTimeoutId){stop();start()}};var mouseEnter=function(){pause()};var mouseLeave=function(){restart()};return{_construct:_construct,_destruct:_destruct,stop:stop,start:start,restart:restart,mouseLeave:mouseLeave}})();var blurBackground=(function(){var start=function(ele){if(conditionObj.isNotBlur()){return}
if(ele&&ele.length){ele.removeClass('ftwp-unblur').addClass('ftwp-blur')}};var stop=function(ele){if(ele&&ele.length&&ele.hasClass('ftwp-blur')){ele.removeClass('ftwp-blur').addClass('ftwp-unblur');setTimeout(function(){ele.removeClass('ftwp-unblur')},500)}};var clear=function(ele){if(ele&&ele.length){ele.removeClass('ftwp-blur ftwp-unblur')}};return{start:start,stop:stop,clear:clear}})();var blurBody=(function(){var $targets;var _construct=function(){init();$e.window.on('ftocResize',initOnResize);$e.container.on('ftocAfterMaximize',afterMax);$e.container.on('ftocAfterMinimize',afterMin);$e.container.on('ftocAfterScrollToTarget',afterScrollToTarget);consoleLog('Actived blurBody().')};var _destruct=function(){uninit();$e.window.off('ftocResize',initOnResize);$e.container.off('ftocAfterMaximize',afterMax);$e.container.off('ftocAfterMinimize',afterMin);$e.container.off('ftocAfterScrollToTarget',afterScrollToTarget);consoleLog('Deactivated blurBody().')};var init=function(){$targets=$e.container.siblings(':not("script, style")');if(minMaxFtoc.isMax()&&isBlur()){blurBackground.start($targets)}};var initOnResize=function(){if(minMaxFtoc.isMax()&&isBlur()){blurBackground.start($targets)}else{blurBackground.stop($targets)}};var afterMax=function(){if(isBlur()){blurBackground.start($targets)}};var afterMin=function(){blurBackground.stop($targets)};var afterScrollToTarget=function(evt,$anchor){if(isBlur()&&$e.container.hasClass('ftwp-maximize')){minMaxFtoc.minimize();blurBackground.stop($targets);$anchor.trigger('blur')}};var uninit=function(){blurBackground.clear($targets)};var isBlur=function(){return $e.window.width()*0.6<=$e.contents.outerWidth()};return{_construct:_construct,_destruct:_destruct}})();if(conditionObj.fixedWidget()){var blurWidgets=(function(){var $targets;var _construct=function(){$targets=$e.widget.siblings('.widget');init();$e.contents.on('ftocAfterExpandContents',startBlur);$e.contents.on('ftocAfterCollapseContents',stopBlur);consoleLog('Actived blurWidgets().')};var _destruct=function(){uninit();$e.contents.off('ftocAfterExpandContents',startBlur);$e.contents.off('ftocAfterCollapseContents',stopBlur);consoleLog('Deactivated blurWidgets().')};var init=function(){if('expand'==$e.contents.data('colexp')){blurBackground.start($targets)}};var startBlur=function(){blurBackground.start($targets)};var stopBlur=function(){blurBackground.stop($targets)};var uninit=function(){blurBackground.clear($targets)};return{_construct:_construct,_destruct:_destruct}})()}
if(conditionObj.inWidget()||conditionObj.supportInPost()){var colExpContents=(function(){var funcExp,funcCol,firstInit=!0;var construct=function(expFunc,colFunc){funcExp=expFunc;funcCol=colFunc;init();var clickableElement=conditionObj.isClickableHeader()?$e.header:$e.minIcon;clickableElement.on('mousedown',preventDefaultEvt);clickableElement.on('click',toggle)};var destruct=function(){uninit();var clickableElement=conditionObj.isClickableHeader()?$e.header:$e.minIcon;clickableElement.off('mousedown',preventDefaultEvt);clickableElement.off('click',toggle)};var init=function(){if(conditionObj.isMobile()&&firstInit){console.log(conditionObj.isColExpInitMobile());if(conditionObj.isColExpInitMobile()){collapse(0,funcCol)}else{expand(0,funcExp)}
controlObj.reload()}else if(isExpand()){expand(0,funcExp)}else{collapse(0,funcCol)}
firstInit=!1};var uninit=function(){$e.list.show(0);$e.minIcon.removeClass('ftwp-icon-collapse ftwp-icon-expand')};var toggle=function(evt){if(isExpand()){collapse(100,funcCol,evt)}else{expand(100,funcExp,evt)}};var isExpand=function(){var colExpData=$e.contents.data('colexp');return'expand'==colExpData||undefined===colExpData};var collapse=function(duration,func,evt){$e.list.hide(duration,function(){$e.minIcon.removeClass('ftwp-icon-expand').addClass('ftwp-icon-collapse');if(undefined!==func)func(evt)});$e.contents.data('colexp','collapse');$e.contents.trigger('ftocAfterCollapseContents');consoleLog('Collapsed contents.')};var expand=function(duration,func,evt){$e.list.show(duration,function(){$e.minIcon.removeClass('ftwp-icon-collapse').addClass('ftwp-icon-expand');if(undefined!==func)func(evt)});$e.contents.data('colexp','expand');$e.contents.trigger('ftocAfterExpandContents');consoleLog('Expanded contents.')};return{construct:construct,destruct:destruct}})()}
if(conditionObj.inWidget()){var colExpConentsInWidget=(function(){var _construct=function(){colExpContents.construct();consoleLog('Actived colExpConentsInWidget().')};var _destruct=function(){colExpContents.destruct();consoleLog('Deactivated colExpConentsInWidget().')};return{_construct:_construct,_destruct:_destruct}})()}
if(conditionObj.fixedWidget()){var colExpConentsInFixedWidget=(function(){var _construct=function(){colExpContents.construct(funcExp,funcCol);consoleLog('Actived colExpConentsInFixedWidget().')};var _destruct=function(){colExpContents.destruct();consoleLog('Deactivated colExpConentsInFixedWidget().')};var funcExp=function(){dataObj.ftocRectInWidget.updateHeight();fixedInWidget.setFixed()};var funcCol=function(){dataObj.ftocRectInWidget.updateHeight();fixedInWidget.setFixed()};return{_construct:_construct,_destruct:_destruct}})()}
if(conditionObj.inWidget()){var displayInWidget=(function(){var _construct=function(){init();consoleLog('Actived displayInWidget().')};var _destruct=function(){$e.contents.css('height','');consoleLog('Deactivated displayInWidget().')};var init=function(){if(!$e.container.parent().is($e.widgetContainer)){$e.container.appendTo($e.widgetContainer)}
$e.contents.css('height','auto')};return{_construct:_construct,_destruct:_destruct,init:init}})()}
if(conditionObj.fixedWidget()){var fixedInWidget=(function(){var _construct=function(){init();setFixed();$e.window.on('ftocResize',setFixed);consoleLog('Actived fixedInWidget().')};var _destruct=function(){init();unsetFixed();$e.window.off('ftocResize',setFixed);listHeight.unset();consoleLog('Deactivated fixedInWidget().')};var init=function(){displayInWidget.init()};var setFixed=function(){$e.widget.addClass('ftwp-widget-fixed');var rect=dataObj.data.ftocRectInWidget;$e.contents.css({left:rect.left,top:rect.top,width:rect.width+'px',height:rect.height+'px'});var contentsHeight=getContentsHeight(rect.height);listHeight.set(contentsHeight)};var unsetFixed=function(){$e.widget.removeClass('ftwp-widget-fixed');$e.contents.css({left:'',top:'',width:'',height:''})};return{_construct:_construct,_destruct:_destruct,setFixed:setFixed}})()}
if(conditionObj.supportInPost()){var displayInPost=(function(){var _construct=function(){init();$e.window.on('ftocResize',setSize);consoleLog('Actived displayInPost().')};var _destruct=function(){uninit();$e.window.off('ftocResize',setSize);if(conditionObj.isAutoHeightInPost()){var height=$e.containerOuter.height();$e.containerOuter.css('height',height+'px')}
consoleLog('Deactivated displayInPost().')};var init=function(){if(!$e.container.parent().is($e.containerOuter)){$e.container.appendTo($e.containerOuter)}
setSize()};var uninit=function(){$e.contents.css('height','');listHeight.unset()};var containerOuterWidth;var setSize=function(){if(0==fixedtocOption.contentsWidthInPost&&conditionObj.isFloat()){$e.containerOuter.css('width','');containerOuterWidth=$e.containerOuter.outerWidth();$e.containerOuter.css('width',containerOuterWidth+'px')}else{$e.containerOuter.css('width','')}
if(conditionObj.isAutoHeightInPost()){$e.containerOuter.css('height','auto');$e.contents.css('height','auto');listHeight.setAuto()}else{$e.containerOuter.css('height',dataObj.data.containerOuterHeight+'px');$e.contents.css('height',dataObj.data.containerOuterHeight+'px');var contentsHeight=getContentsHeight(dataObj.data.containerOuterHeight);listHeight.set(contentsHeight)}};return{_construct:_construct,_destruct:_destruct}})();var colExpConentsInPost=(function(){var _construct=function(){colExpContents.construct(funcExp,funcCol);consoleLog('Actived colExpConentsInFixedWidget().')};var _destruct=function(){colExpContents.destruct();consoleLog('Deactivated colExpConentsInFixedWidget().')};var funcExp=function(evt){funcCol(evt)};var funcCol=function(evt){if(undefined!==evt&&'click'==evt.type){dataObj.updateInPost()}};return{_construct:_construct,_destruct:_destruct}})()}
var controlObj=(function(){var onReady=function(){option.init();createElements();setAnchorIndex();$e.container.trigger('ftocReady');onLoad();setTimeout(reload,100);consoleLog(fixedtocOption)};var onLoad=function(){dataObj.createOnInit();if(conditionObj.isColExpList()){actionObj.register('common',colExpSubList)}
actionObj.register('common',scrollToTarget);actionObj.register('common',targetIndicator);actionObj.register('hidden',hideToc);if(conditionObj.fixedWidget()){actionObj.register('fixedWidget',colExpConentsInFixedWidget);actionObj.register('fixedWidget',fixedInWidget);actionObj.register('fixedWidget',blurWidgets)}
if(conditionObj.inWidget()){actionObj.register('inWidget',displayInWidget);actionObj.register('inWidget',colExpConentsInWidget)}
if(conditionObj.supportInPost()){actionObj.register('inPost',displayInPost);actionObj.register('inPost',colExpConentsInPost)}
actionObj.register('fixedToPost',ftocInOut);actionObj.register('fixedToPost',minMaxFtoc);actionObj.register('fixedToPost',fadeTrigger);actionObj.register('fixedToPost',blurBody);actionObj.init();$e.window.on('resize',onResize);$e.window.on('scroll',onScroll)};var onResize=function(){dataObj.updateOnResize();actionObj.updateOnResize();$e.window.trigger('ftocResize')};var onScroll=function(){dataObj.updateOnDocumentHeightChange();dataObj.updateOnScroll();actionObj.updateOnScroll();$e.window.trigger('ftocScroll')};var reload=function(){consoleLog(fixedtocOption);dataObj.updateOnResize();actionObj.updateOnResize();$e.window.trigger('ftocResize')};return{option:option,onReady:onReady,reload:reload}})();$(document).ready(controlObj.onReady);$(document).on('load',conditionObj.reload);return{option:controlObj.option,reload:controlObj.reload}})(jQuery)